From 9b97899d60053bcf5a23c1ee31b596a7cd6d6a55 Mon Sep 17 00:00:00 2001
From: Jordi Sanfeliu <jordi@fibranet.cat>
Date: Fri, 17 May 2013 11:57:48 +0200
Subject: [PATCH] Added the ability to specify an optional host address for
 the built-in HTTP server to bind to. [#19]

---
 Changes                   | 2 ++
 lib/Monitorix.pm          | 6 +++++-
 man/man5/monitorix.conf.5 | 9 ++++++++-
 monitorix.conf            | 1 +
 4 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/Changes b/Changes
index 51bb775..8adeb33 100644
--- a/Changes
+++ b/Changes
@@ -28,6 +28,8 @@
   <desc> option was empty. Also, Socket module has been added.
 - Fixed to get the correct graph of the right group number in the 'fs' graph
   when using 'silent=imagetag' option. [#16]
+- Added the ability to specify an optional host address for the built-in HTTP
+  server to bind to. [#19]
 
 
 3.1.0  - 15-Mar-2013
diff --git a/lib/Monitorix.pm b/lib/Monitorix.pm
index 6be03b6..470b082 100644
--- a/lib/Monitorix.pm
+++ b/lib/Monitorix.pm
@@ -24,6 +24,7 @@ use strict;
 use warnings;
 use Exporter 'import';
 use POSIX qw(setuid setgid setsid);
+use Socket;
 our @EXPORT = qw(logger trim min max celsius_to httpd_setup get_nvidia_data get_ati_data flush_accounting_rules);
 
 sub logger {
@@ -75,6 +76,7 @@ sub httpd_setup {
 
 	my (undef, undef, $uid) = getpwnam($config->{httpd_builtin}->{user});
 	my (undef, undef, $gid) = getgrnam($config->{httpd_builtin}->{group});
+	my $host = $config->{httpd_builtin}->{host};
 	my $port = $config->{httpd_builtin}->{port};
 
 	if(!defined($uid)) {
@@ -107,7 +109,9 @@ sub httpd_setup {
 	$0 = "monitorix-httpd listening on $port";	# change process' name
 	chdir($config->{base_dir});
 
-	my $server = HTTPServer->new($port);
+	my $server = HTTPServer->new();
+	$server->host($host);
+	$server->port($port);
 	$server->run();
 	exit(0);
 }
diff --git a/man/man5/monitorix.conf.5 b/man/man5/monitorix.conf.5
index f1a8bde..e1b5d72 100644
--- a/man/man5/monitorix.conf.5
+++ b/man/man5/monitorix.conf.5
@@ -32,7 +32,7 @@ Default value: \fIPlace a Title Here\fP
 .RS
 The name of the host.
 .P
-Default value: none
+Default value: 
 .RE
 .P
 .BI theme_color
@@ -159,6 +159,13 @@ This enables or disables the HTTP server that Monitorix has built-in. This is sp
 Default value: \fIy\fP
 .RE
 .P
+.BI host
+.RS
+This option takes an optional host address for this server to bind to. If none is specified (default) it will bind to all interfaces.
+.P
+Default value: 
+.RE
+.P
 .BI port
 .RS
 This is the network port from where the HTTP server will listen on.
diff --git a/monitorix.conf b/monitorix.conf
index bd58006..9285994 100644
--- a/monitorix.conf
+++ b/monitorix.conf
@@ -20,6 +20,7 @@ base_cgi = /monitorix-cgi
 
 <httpd_builtin>
 	enabled = y
+	host =
 	port = 8080
 	user = nobody
 	group = nobody
-- 
1.7.12.1

